<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>MongoDBè‡ªå­¦ç¬”è®°</title>
  <meta name="description" content="MongoDB å®æˆ˜[ç¾] Kyle Banker">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="MongoDBè‡ªå­¦ç¬”è®°">
  <meta name="twitter:description" content="MongoDB å®æˆ˜[ç¾] Kyle Banker">

  <meta property="og:type" content="article">
  <meta property="og:title" content="MongoDBè‡ªå­¦ç¬”è®°">
  <meta property="og:description" content="MongoDB å®æˆ˜[ç¾] Kyle Banker">

  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">

  <link rel="stylesheet" href="/css/main.css">
  <!-- <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <link rel="canonical" href="http://C0ldstudy.github.io/2017/11/MongoDB/">
  <link rel="alternate" type="application/rss+xml" title="Jason Xu" href="http://C0ldstudy.github.io/feed.xml">

  <!-- kramdown-math-katex latex sytax for markdown -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"> -->
  <!-- <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script> -->


<!-- ç«™ç‚¹ç»Ÿè®¡ -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!-- google ç»Ÿè®¡ -->
   
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-118980599-1', 'auto');
      ga('send', 'pageview');
  </script>
  

</head>

  <body>
    <span class="mobile btn-mobile-menu">
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">
                Homepage
              </a>
            </i>
            
                <i class="nav-menu-item">
                  <a href="/timeline" title="timeline" class="btn-mobile-menu__icon">
                      Timeline
                  </a>
                </i>
            
                <i class="nav-menu-item">
                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      Tag
                  </a>
                </i>
            
                <i class="nav-menu-item">
                  <a href="/photography" title="photography" class="btn-mobile-menu__icon">
                      Photography
                  </a>
                </i>
            
                <i class="nav-menu-item">
                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      About me
                  </a>
                </i>
            
          </nav>
      </div>
    </span>




    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- å¤´åƒæ•ˆæœ-start -->
        <div class="ih-item circle effect right_to_left">
            <a href="/#blog" title="å‰å¾€ Jason Xu çš„ä¸»é¡µ" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2>
                            
                                C0ldstudy
                            
                        </h2>
                        <p>
                           
                                Machine Learning / Security
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- å¤´åƒæ•ˆæœ-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Jason Xu" class="blog-button">Jason Xu</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">Personal Station</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">In the end, we only regret the chances we didn't take.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        <p class="panel-cover__description">ğŸ‡¨ğŸ‡³Shanghai -> ğŸ‡­ğŸ‡°Hong Kong -> ğŸ‡ºğŸ‡¸Irvine</p>
        


        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Homepage</a></li>
                
                  <li class="navigation__item"><a href="/timeline" title="timeline">Timeline</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">Tag</a></li>
                
                  <li class="navigation__item"><a href="/photography" title="photography">Photography</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">About me</a></li>
                
              </ul>
            </nav>
          </div>
        </div>


        </div>
      </div>
    </div>

    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            


<article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">MongoDBè‡ªå­¦ç¬”è®°</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px"/>
      <time datetime="2017-11-07 00:00:00 -0800" itemprop="datePublished" class="post-meta__date date">2017-11-07 | </time>
      <span id="busuanzi_container_page_pv" style='display:none'> Read: <span id="busuanzi_value_page_pv"></span> Times</span>

    </div>
  </header>

  <section class="post">

    <h2 id="mongodb-å®æˆ˜">MongoDB å®æˆ˜</h2>
<p><strong>[ç¾] Kyle Banker</strong></p>

<h5 id="1-ä¸»è¦ç‰¹æ€§">1. ä¸»è¦ç‰¹æ€§</h5>

<p>1.1 æ–‡æ¡£æ•°æ®æ¨¡å‹</p>

<p>ç±»ä¼¼äºJsonçš„æ ¼å¼æ¥å­˜å‚¨æ•°æ®ï¼Œä¸éœ€è¦åƒå…³ç³»å‹æ•°æ®åº“é‚£æ ·åœ¨é‡åˆ°ä¸€å¯¹å¤šçš„æƒ…å†µä¸‹è¦å†™å¤šå¼ è¡¨ã€‚</p>

<p>1.2 å³æ—¶æŸ¥è¯¢</p>

<p>MongoDBå®ç°ç±»ä¼¼å³æ—¶æŸ¥è¯¢çš„æ–¹æ³•ï¼š
<code class="language-plaintext highlighter-rouge">db.posts.find({'tags': 'politics', 'vote_count':{'gt': 10}});</code></p>

<p>1.3 äºŒçº§ç´¢å¼•</p>

<p>B-tree</p>

<p>1.4 å¤åˆ¶</p>

<p>é€šè¿‡å‰¯æœ¬é›†çš„æ‹“æ‰‘ç»“æ„å®ç°å¤åˆ¶åŠŸèƒ½ã€‚å‰¯æœ¬é›†æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œå¤šä¸ªä»èŠ‚ç‚¹ç»„æˆï¼Œä¸»èŠ‚ç‚¹å¯ä»¥è¯»å†™ã€å­èŠ‚ç‚¹åªèƒ½è¯»ï¼›è‹¥ä¸»èŠ‚ç‚¹æ•…éšœï¼Œåˆ™è‡ªåŠ¨ä»å­èŠ‚ç‚¹æ‰¾æ›¿ä»£ã€‚</p>

<p>1.5 é€Ÿåº¦å’ŒæŒä¹…æ€§</p>

<p>é€Ÿåº¦æŒ‡æ“ä½œæ•°æ®çš„æ—¶é—´å¤šå°‘ï¼›æŒä¹…æ€§æŒ‡æ•°æ®èƒ½ç»´æŒçš„æ—¶é—´é•¿çŸ­ï¼›
MongoDBå¯ä»¥è®¾ç½®æ˜¯å¦å¼€å¯Journalingæ—¥å¿—è®°å½•</p>

<p>1.6 æ•°æ®åº“æ‰©å±•</p>

<p>åˆ†ç‰‡</p>

<p>1.7 å‘½ä»¤è¡Œå·¥å…·</p>

<ul>
  <li>å¤‡ä»½å’Œæ¢å¤æ•°æ®åº“:<code class="language-plaintext highlighter-rouge">mongodump</code>/<code class="language-plaintext highlighter-rouge">mongorestore</code></li>
  <li>å¯¼å…¥å¯¼å‡ºJSON/CSV/TSVæ•°æ®: <code class="language-plaintext highlighter-rouge">mongoexport</code>/<code class="language-plaintext highlighter-rouge">mongoimport</code></li>
</ul>

<h5 id="2-mongodb-shellå¸¸ç”¨æŒ‡ä»¤">2. MongoDB Shellå¸¸ç”¨æŒ‡ä»¤</h5>

<ul>
  <li><code class="language-plaintext highlighter-rouge">db.users.save()</code>/<code class="language-plaintext highlighter-rouge">db.users.insert()</code>	æ·»åŠ é¡¹</li>
  <li><code class="language-plaintext highlighter-rouge">db.users.count()</code>	è®¡æ•°</li>
  <li><code class="language-plaintext highlighter-rouge">db.users.find()</code>		æŸ¥è¯¢</li>
  <li><code class="language-plaintext highlighter-rouge">db.users.update({username:"smith"}, {$set: {country: "Canada"}})</code>	å¢åŠ å›½å®¶å±æ€§</li>
  <li><code class="language-plaintext highlighter-rouge">db.users.update( {username: "smith"}, { $set: {favorits: { cities:["Chicago", "Cheyenne"], movies: ["Casablanca", "The Sting"] } }})</code></li>
  <li><code class="language-plaintext highlighter-rouge">db.users.remove()</code>		åˆ é™¤æ•°æ®</li>
  <li><code class="language-plaintext highlighter-rouge">db.users.drop()</code>		åˆ é™¤æ‰€æœ‰ç´¢å¼•</li>
  <li><code class="language-plaintext highlighter-rouge">db.numbers.ensureIndex({num:1})</code> 	ä¸ºnumé”®åˆ›å»ºç´¢å¼•</li>
  <li>æ•°æ®åº“åŸºæœ¬æ“ä½œ
    <ul>
      <li>show dbs</li>
      <li>show collections</li>
      <li>db.stats()/db.numbers.stats()	è·å–æ•°æ®åº“/é›†åˆåº•å±‚ä¿¡æ¯</li>
    </ul>
  </li>
</ul>

<h5 id="3-ä½¿ç”¨mongodbç¼–å†™ç¨‹åº">3. ä½¿ç”¨MongoDBç¼–å†™ç¨‹åº</h5>

<p>ruby</p>

<hr />

<h2 id="mongodbæƒå¨æŒ‡å—">MongoDBæƒå¨æŒ‡å—</h2>

<p><strong>[ç¾]Kristina Chodorow &amp; Michael Dirolf</strong></p>

<hr />

<h2 id="mongodb-university">MongoDB University</h2>

<p>M101P: MongoDB for Developers</p>

<h4 id="chapter-1-introduction">Chapter 1: Introduction</h4>

<p>1.1 <code class="language-plaintext highlighter-rouge">db.collection.insert()</code>, <code class="language-plaintext highlighter-rouge">db.collection.find().pretty()</code> we can use <code class="language-plaintext highlighter-rouge">pretty()</code> to configure the cursor to display results in an easy-to-read format.</p>

<p>1.2 <code class="language-plaintext highlighter-rouge">cursor.hasNext()/next()</code> is used to list the whole collections by the cursor.</p>

<p>1.3 <code class="language-plaintext highlighter-rouge">del(g['name'])</code> is uesd to delete a item in a python dictionary.</p>

<p>1.4 <code class="language-plaintext highlighter-rouge">curl -i locolhost:8080</code> can get a header and content back.</p>

<p>1.5 set cookie which is got by Get method</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fruit = bottle.request.forms.get("fruit")
bottle.response.set_cookie("fruit", fruit)
bollle.redirect("/show_fruit") 
</code></pre></div></div>

<h4 id="chapter-3-schema-design">Chapter 3: Schema Design</h4>

<p>3.1 foreign key constraints</p>

<h4 id="chapter-4-performance">Chapter 4: Performance</h4>

<p>4.1 Pluggable storage engines inclues MMAP(default) and WiredTiger(2014)</p>

<ul>
  <li>WiredTiger: Document Level Concurrency, Compress on data</li>
</ul>

<p>4.2 Index</p>

<ul>
  <li>create Index: <code class="language-plaintext highlighter-rouge">db.students.createIndex({student_id:1});</code></li>
  <li>delete Index: <code class="language-plaintext highlighter-rouge">db.students.dropIndex({student_id:1});</code></li>
</ul>

<p>create Index on tags</p>

<ul>
  <li>
    <p>elemMatch: <code class="language-plaintext highlighter-rouge">db.students.explain().find({'scores':{$elemMatch: {type:'exam'. score:{'$gt':99.8}}}});</code> it is used to meet the requirements in the search.</p>
  </li>
  <li>create unique index: <code class="language-plaintext highlighter-rouge">db.stuff.createIndex({thing:1}, {unique:true});</code></li>
  <li>delete the same item: <code class="language-plaintext highlighter-rouge">db.stuff.remove({thing:'apple'}, {justOne: true});</code></li>
  <li>sparse index: can not be used for sorting</li>
  <li>create the Index in the background: <code class="language-plaintext highlighter-rouge">db.students.createIndex({'scores.score':1},{background:true});</code></li>
  <li>Explain: Verbosity</li>
  <li>Covered Queries: search require and result are all index
    <ul>
      <li>all the fields in the query are part of an index;</li>
      <li>all the fields returned in the results are in the same index</li>
      <li><code class="language-plaintext highlighter-rouge">db.collection.find(query, projection)</code>: query(query requirement), projection(display return keys)</li>
    </ul>
  </li>
  <li>Geospatial Index:
    <ul>
      <li>ensure Index: <code class="language-plaintext highlighter-rouge">db.stores.ensureIndex({location: 2d, type:1});</code></li>
      <li><code class="language-plaintext highlighter-rouge">db.stores.find({location:{$near:[50,50]}});</code></li>
    </ul>
  </li>
  <li>Geospatial Spherical: Longitude, Latitude. Using GeoJSON
    <ul>
      <li><code class="language-plaintext highlighter-rouge">db.places.ensureIndex({'location':  '2dsphere'});</code></li>
      <li><code class="language-plaintext highlighter-rouge">db.places.find({location: {$near: {$geometry: {type: "Point", coordinates: [122,37]}, $masDistance: 2000}}});</code></li>
      <li><code class="language-plaintext highlighter-rouge">db.stores.find({loc: {$near: {$geometry: {type: "Point", coordinates: [-130,39]}, $maxDistance: 1000000}}});</code></li>
    </ul>
  </li>
  <li>Text Indexes: <code class="language-plaintext highlighter-rouge">db.sentences.ensureIndex({'words': 'text'});</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">db.sentences.find({$text:{$search:'dog tree obsidian'}}, {Score:{$meta: 'textScore'}}).sort({score:{$meta:'textScore'}});</code> The command will list the text by the similarity of the words.</li>
      <li><code class="language-plaintext highlighter-rouge">db.students.dinf({student_id:{$gt: 500000}, class_id: 54}).sort({student_id:1}).hint({class_i:1}).explian("executionStats")</code></li>
      <li>query order: equality-sort-range</li>
    </ul>
  </li>
</ul>

<p>4.3 Profile mode</p>

<ul>
  <li>0: nolog</li>
  <li>1: log slow query</li>
  <li>2: log every query</li>
  <li>command: <code class="language-plaintext highlighter-rouge">mongod -dbpath /usr/local/var/mongodb --profile 1 --slowms 2</code></li>
  <li><code class="language-plaintext highlighter-rouge">db.system.profile.find({ns:/test.foo/}).sort({ts:1}).pretty()</code></li>
  <li><code class="language-plaintext highlighter-rouge">db.system.profile.find({millis:{$gt:1}}).sort({ts:1}).pretty()</code></li>
</ul>

<p><strong>Answer4.3</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.posts.ensureIndex({ date : -1});
db.posts.ensureIndex({ tags : 1,  date : -1});
db.posts.ensureIndex({ permalink : 1});
</code></pre></div></div>

<h4 id="5-aggregation-framework">5. Aggregation Framework</h4>

<p>5.1 count the sum:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.products.aggregate([
	{ $group: 
		{
			"_id:"$category", 
			"num_products":{"$sum":1}
		}
	}
]); 5.2 aggregation pipeline
</code></pre></div></div>

<ul>
  <li>$project</li>
  <li>$match</li>
  <li>$group</li>
  <li>$sort</li>
  <li>$skip</li>
  <li>$limit</li>
  <li>$unwind</li>
  <li>$out</li>
  <li>$redata</li>
  <li>$geonear</li>
</ul>

<p>5.3 aggregation expressions <strong>aggregate([stage1, stage2],{options})</strong></p>

<ul>
  <li>$sum: <code class="language-plaintext highlighter-rouge">db.zips.aggregate([{"$group": {"_id":"$state","population":{$sum:"$pop"}}}])</code>, sum population grouped as state</li>
  <li>$avg: <code class="language-plaintext highlighter-rouge">db.zips.aggregate([{$group: {"_id":"$state","average_pop":{$avg:"$pop"}}}])</code></li>
  <li>$min</li>
  <li>$max: <code class="language-plaintext highlighter-rouge">db.zips.aggregate([{$group: {_id: "$state", pop: {$max:"$pop"}}}])</code></li>
  <li>$push</li>
  <li>$addtoSet: <code class="language-plaintext highlighter-rouge">db.zips.aggregate([{$group: {"_id":"$city", "postal_codes":{$addToSet:"$_id"}}}])</code></li>
  <li>$first/$last: must be used after sorts</li>
  <li>
    <p>$project</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  db.products.aggregate([
      {$project:
   	{
   		_id:0,
   		'maker': {$toLower:"$manufacturer"},
   		'details': {'category': "$category",
          				'price' : {"$multiply":["$price",10]}
          			},
   		'item':'$name'
   	}
      }
  ])
</code></pre></div>    </div>
  </li>
</ul>

<p>If you want to include a key exactly as it is named in the source document, you just write key:1, where key is the name of the key.<code class="language-plaintext highlighter-rouge">db.zips.aggregate([{$project: {_id: 0, city: {$toLower: "$city"}, pop:1, state:1, zip:"$_id"}}])</code></p>

<ul>
  <li>$match: <code class="language-plaintext highlighter-rouge">db.zips.aggregate([{$match: { pop: {$gt:100000}}}])</code></li>
  <li>$text:</li>
  <li>$sort: <code class="language-plaintext highlighter-rouge">db.zips.aggregate([{ $sort:{state:1, city:1}}])</code></li>
  <li>$unwind: unjoin the data</li>
  <li>$out:(new in Mongodb2.6),rewrite the collection</li>
  <li>{explain:true},{allowDiskUse:true}</li>
</ul>

<p>5.4 Homework</p>

<p>5.4.1 <code class="language-plaintext highlighter-rouge">db.posts.aggregate([{$unwind: "$comments"},{$group:{_id: "$comments.author",count : {$sum:1}}},{$sort:{count:-1}}])</code> This task need to count the commentsâ€™ authorâ€™s sum which is in the subJson. Need to be rejoin the whole Json.</p>

<p>5.4.2 the result is smaller than the correct answer but it is near. <strong>Do not figure out the reason.</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.zips.aggregate([
	{$match:{ $or: [{state:"CA"}, {state:"NY"}]}},
	{$match: {pop: {$gt:25000}}},
	{$group: {_id:0, avg: {$avg:"$pop"}}}
])
</code></pre></div></div>

<p>5.4.3</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.grades.aggregate([
	{ $unwind: "$scores" },
	{ $match: { $or: [ {"scores.type": "homework"}, {"scores.type":"exam"} ] } },
	{ $group: { _id: { 'student_id': "$student_id", 'class_id': "$class_id" }, avg: { $avg: "$scores.score" } } },
	{ $group: { _id: "$_id.class_id", class_avg: { $avg: "$avg" } } },
	{ $sort: { 'class_avg': -1 } }
])
</code></pre></div></div>

<p>5.4.4</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db.zips.aggregate([
{ $project: { _id: 0, city: 1, pop: 1 } },
{ $match: { city: /^(B|D|O|G|N|M).*/ } },
{ $group: { _id: null, pop: { $sum: "$pop" } } },
{ $sort: { city: 1} }
])
</code></pre></div></div>

<p>5.5 the different between $group and $project</p>

<h4 id="6-application-engineering">6. Application Engineering</h4>

<p>6.1 Write Concern:</p>

<ul>
  <li>w: whether the application wait for the serverâ€™s acknowledge during the response. 1(wait)/0(not)</li>
  <li>j: whether the application wait for the serverâ€™s response on writing the disk. Ture(wait)/False(not)</li>
</ul>

<p>6.2 Replica Set</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># script to create 3 replica sets: sudo bash &lt; ./create_replica_set.sh
#!/usr/bin/env bash
mkdir -p /data/rs1 /data/rs2 /data/rs3
mon	god --replSet m101 --logpath "1.log" --dbpath /data/rs1 --port 27017 --oplogSize 	64 --fork --smallfiles
mongod --replSet m101 --logpath "2.log" --dbpath /data/rs2 --port 27018 --oplogSize 	64 --smallfiles --fork
mongod --replSet m101 --logpath "3.log" --dbpath /data/rs3 --port 27019 --oplogSize 	64 --smallfiles --fork

# init the replica set
conf	ig = { _id: "m101", members:[
          { _id : 0, host : "localhost:27017"},
          { _id : 1, host : "localhost:27018"},
          { _id : 2, host : "localhost:27019"} ]
};
rs.initiate(config);
rs.status();
</code></pre></div></div>

<ul>
  <li>Reading from a secondary set: <code class="language-plaintext highlighter-rouge">rs.slaveOk()</code>(rs means replica set)</li>
  <li>connect to different database: <code class="language-plaintext highlighter-rouge">mongo --port 27017/8/9</code></li>
  <li>secondaries use oplog to synchronize the primary dataset.</li>
  <li>shut down the dataset: <code class="language-plaintext highlighter-rouge">rs.stepDown()</code></li>
</ul>

<p>6.3 Failover and Rollback</p>


  </section>
<!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> -->
</article>

<section>
       <ul class="pager">
        
        <li class="previous">
            <a href="/2017/10/%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0/" data-toggle="tooltip" data-placement="top" title="å®‰å…¨ç¬”è®°æ¦‚è®º">Last Blogï¼š  <span>å®‰å…¨ç¬”è®°æ¦‚è®º</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2017/11/%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B02/" data-toggle="tooltip" data-placement="top" title="å®‰å…¨ç¬”è®°--Webæ”»å‡»æŠ€æœ¯">Next Blogï¼š  <span>å®‰å…¨ç¬”è®°--Webæ”»å‡»æŠ€æœ¯</span>
            </a>
        </li>
        
    </ul>
</section>

<section class="post-comments">
<div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      // Here is an example,
      this.page.url = "https://c0ldstudy.github.io/2017/11/MongoDB/";
      this.page.identifier = "/2017/11/MongoDB/";
    };

    // You should be able to get the following lines of code from your Disqus admin.
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = '//c0ldstudy-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
</section>


            <section class="footer">
    <footer>
        <div class = "footer_div">
          <div clas="recordings" style="display:flex;justify-content:space-around;">
          <div class="twitter_display">
            <div class='jekyll-twitter-plugin'><a class="twitter-timeline" data-width="300" data-tweet-limit="1" href="https://twitter.com/JiacenXu?ref_src=twsrc%5Etfw">Tweets by JiacenXu</a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
          </div>
          <div class="github_chart">
            <img src="http://ghchart.rshah.org/409ba5/C0ldstudy" alt="C0ldstudy's Blue Github chart"/>
            <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=400&t=n&d=PWaejm3rz2TG6HOtwcekX2kM9kPWz2aP6GYhuOVoNpA&co=2d78ad&cmo=3acc3a&cmn=ff5353&ct=ffffff'></script>
          </div>
        </div>
            <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/c0ldstudy" title="@c0ldstudy çš„ Github" target="_blank">
              <i class='fab fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
          
          
          <!-- Twitter -->
          <li class="navigation__item_social">
            <a href="https://twitter.com/JiacenXu" title="@JiacenXu" target="_blank">
              <i class='fab fa-twitter fa-2x'></i>
              <span class="label">Twitter</span>
            </a>
          </li>
          

          
          <!-- LinkedIn -->
          <li class="navigation__item_social">
            <a href="https://www.linkedin.com/in/jiacen-xu-021536105/" title="@jiacen-xu-021536105" target="_blank">
              <i class='fab fa-linkedin fa-2x'></i>
              <span class="label">LinkedIn</span>
            </a>
          </li>
          
          

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:coldstudyxu@gmail.com" title="Contact me">
              <i class='fa fa-envelope fa-2x'></i>
              <span class="label">Email</span>
            </a>
          </li>
          
          </ul>
        </nav>
        </div>

        <div class = "footer_div_counter">
           <p class="copyright text-muted">
            Copyright &copy; Jason Xu 2022 Theme by <a href="http://c0ldstudy.github.io/">C0ldstudy</a> |
            <iframe
                style="margin-left: 2px; margin-bottom:-5px;"
                frameborder="0" scrolling="0" width="91px" height="20px"
                src="https://ghbtns.com/github-btn.html?user=c0ldstudy&repo=c0ldstudy.github.io&type=star&count=true" >
            </iframe>
            </p>
        	<div align="right">
    			<!-- <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css"> -->
          <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

          <!-- è®¿é—®ç»Ÿè®¡ -->
          <span id="busuanzi_container_site_uv" style='display:none'>
          <span id="busuanzi_value_site_uv"></span> People Visited!
          </span>
        </div>
        </div>
    </footer>
</section>

        </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  </body>

</html>
